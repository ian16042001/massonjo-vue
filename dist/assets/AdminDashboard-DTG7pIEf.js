import{h as m,B as _,C as J,G as K,H as Q,c as r,b as e,l as W,d as X,w as Y,r as Z,t as n,f as B,k as z,i as N,v as ee,D as te,F as w,g as k,E as se,u as c,o as d,a as A}from"./index-FJzA_NzK.js";import{a as p}from"./api-C_gadaYi.js";const oe={class:"min-h-screen bg-gray-100"},le={class:"bg-gray-900 text-white shadow-lg"},ne={class:"container mx-auto px-4 py-4 flex items-center justify-between"},ie={class:"flex items-center gap-4"},ae={class:"container mx-auto px-4 py-8"},re={class:"grid grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-8"},de={class:"bg-white rounded-xl shadow p-4 md:p-6"},ue={class:"flex items-center justify-between"},ce={class:"text-2xl md:text-3xl font-bold text-gray-900"},xe={class:"bg-white rounded-xl shadow p-4 md:p-6"},me={class:"flex items-center justify-between"},pe={class:"text-2xl md:text-3xl font-bold text-green-600"},ve={class:"bg-white rounded-xl shadow p-4 md:p-6"},ge={class:"flex items-center justify-between"},be={class:"text-2xl md:text-3xl font-bold text-orange-600"},fe={class:"bg-white rounded-xl shadow p-4 md:p-6"},ye={class:"flex items-center justify-between"},he={class:"text-2xl md:text-3xl font-bold text-purple-600"},_e={class:"grid lg:grid-cols-2 gap-8"},we={class:"bg-white rounded-xl shadow-lg"},ke={class:"p-6"},Ae=["min"],Se={class:"grid grid-cols-3 gap-2"},Ce=["onClick"],je=["disabled"],De={class:"mt-8"},Be={class:"font-semibold mb-4 flex items-center justify-between"},Re={class:"text-sm font-normal text-gray-500"},Te={class:"space-y-3 max-h-96 overflow-y-auto"},Ee=["onClick"],ze={class:"flex items-center gap-3"},Ne={class:"font-medium"},Ve={class:"text-sm text-gray-600"},$e=["onClick"],Ie={key:0,class:"border-t border-gray-200 p-3 space-y-2"},Fe={class:"flex items-center gap-3"},Me={class:"font-mono font-medium"},Ue={class:"text-xs text-gray-500"},Le={class:"flex items-center gap-2"},Oe={key:0,class:"text-xs text-gray-600"},Pe=["onClick","disabled","title"],Ge={class:"bg-white rounded-xl shadow-lg"},He={class:"p-6 border-b border-gray-200"},qe={class:"flex gap-2 mt-3"},Je={class:"p-6"},Ke={key:0,class:"text-center py-8"},Qe={key:1,class:"text-center py-8 text-gray-500"},We={key:2,class:"space-y-3 max-h-96 overflow-y-auto"},Xe={class:"flex items-start justify-between"},Ye={class:"flex-1"},Ze={class:"flex items-center gap-2 mb-1"},et={class:"font-bold text-lg"},tt={key:0,class:"bg-red-500 text-white text-xs px-2 py-0.5 rounded-full"},st={class:"font-semibold text-gray-900"},ot={class:"text-sm text-gray-600"},lt={class:"text-sm text-gray-600"},nt={class:"text-sm text-gray-600"},it={class:"mt-2 flex items-center gap-2"},at={class:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded"},rt={class:"text-xs text-gray-500"},dt={key:0,class:"mt-2 text-sm text-gray-700 bg-gray-50 p-2 rounded"},ut=["onClick"],pt={__name:"AdminDashboard",setup(ct){const V=K(),S=Q(),C=m(!1),h=m(!1),v=m([]),j=m([]),f=m({}),x=m("upcoming"),g=new Date().toISOString().split("T")[0],$=["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30"],a=m({date:g,slots:[],duration:60}),I=_(()=>[...v.value].sort((o,t)=>new Date(o.date)-new Date(t.date))),R=_(()=>{let o=[...j.value].sort((t,i)=>{const s=new Date(t.date+"T"+t.time),l=new Date(i.date+"T"+i.time);return s-l});return x.value==="today"?o=o.filter(t=>t.date===g):x.value==="upcoming"&&(o=o.filter(t=>t.date>=g)),o});function F(o){const t=a.value.slots.indexOf(o);t>-1?a.value.slots.splice(t,1):(a.value.slots.push(o),a.value.slots.sort())}async function M(){var o,t;h.value=!0;try{const i=a.value.slots.map(s=>({time:s,duration:parseInt(a.value.duration)}));await p.createAvailability({date:a.value.date,slots:i}),a.value.slots=[],await y(),alert("DisponibilitÃ©s ajoutÃ©es avec succÃ¨s !")}catch(i){alert("Erreur lors de l'ajout: "+(((t=(o=i.response)==null?void 0:o.data)==null?void 0:t.error)||i.message))}finally{h.value=!1}}async function U(o){if(confirm("Supprimer ces disponibilitÃ©s ?"))try{await p.deleteAvailability(o),await y()}catch{alert("Erreur lors de la suppression")}}async function L(o){if(confirm("Annuler ce rendez-vous ?"))try{await p.cancelAppointment(o),await y()}catch{alert("Erreur lors de l'annulation")}}const b=m({}),O=_(()=>v.value.reduce((o,t)=>o+t.slots.length,0)),P=_(()=>v.value.reduce((o,t)=>o+t.slots.filter(i=>!i.isBooked).length,0));function G(o){b.value[o]=!b.value[o]}function D(o,t){return j.value.find(i=>i.date===o&&i.slotId===t)}async function H(o,t){if(confirm("Supprimer ce crÃ©neau ?"))try{const i=v.value.find(u=>u.id===o);if(!i)return;const s=i.slots.find(u=>u.id===t);if(s!=null&&s.isBooked){alert("Ce crÃ©neau est rÃ©servÃ©. Annulez d'abord le rendez-vous.");return}const l=i.slots.filter(u=>u.id!==t).map(u=>({time:u.time,duration:u.duration,isBooked:u.isBooked}));await p.updateAvailabilitySlots(o,l),await y()}catch(i){console.error("Erreur:",i),alert("Erreur lors de la suppression du crÃ©neau")}}async function y(){var o;C.value=!0;try{const[t,i,s]=await Promise.all([p.getAppointments(),p.getAvailabilities(g,"2099-12-31"),p.getStats()]);j.value=t.data,v.value=i.data,f.value=s.data}catch(t){((o=t.response)==null?void 0:o.status)===401&&(localStorage.removeItem("adminToken"),S.push("/admin")),console.error("Erreur chargement:",t)}finally{C.value=!1}v.value.forEach(t=>{b.value[t.id]===void 0&&(b.value[t.id]=!0)})}function T(o){return new Date(o).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}function E(o){return o===g}function q(){localStorage.removeItem("adminToken"),S.push("/admin")}return J(()=>{const o=V.params.token||localStorage.getItem("adminToken");if(!o){S.push("/admin");return}localStorage.setItem("adminToken",o),y()}),(o,t)=>{const i=Z("router-link");return d(),r("div",oe,[e("header",le,[e("div",ne,[t[6]||(t[6]=W('<div class="flex items-center gap-3"><div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center"><span class="text-xl">ğŸ”§</span></div><div><h1 class="font-bold text-lg">Panel Admin</h1><p class="text-xs text-gray-400">Massonjo Chauffage Sanitaire</p></div></div>',1)),e("div",ie,[X(i,{to:"/",class:"text-gray-300 hover:text-white transition-colors"},{default:Y(()=>[...t[5]||(t[5]=[B(" â† Retour au site ",-1)])]),_:1}),e("button",{onClick:q,class:"bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg text-sm font-medium transition-colors"}," DÃ©connexion ")])])]),e("div",ae,[e("div",re,[e("div",de,[e("div",ue,[e("div",null,[t[7]||(t[7]=e("p",{class:"text-xs md:text-sm text-gray-600"},"Total RDV",-1)),e("p",ce,n(f.value.totalAppointments),1)]),t[8]||(t[8]=e("div",{class:"w-10 h-10 md:w-12 md:h-12 bg-blue-100 rounded-full flex items-center justify-center"},[e("span",{class:"text-xl md:text-2xl"},"ğŸ“‹")],-1))])]),e("div",xe,[e("div",me,[e("div",null,[t[9]||(t[9]=e("p",{class:"text-xs md:text-sm text-gray-600"},"Aujourd'hui",-1)),e("p",pe,n(f.value.todayAppointments),1)]),t[10]||(t[10]=e("div",{class:"w-10 h-10 md:w-12 md:h-12 bg-green-100 rounded-full flex items-center justify-center"},[e("span",{class:"text-xl md:text-2xl"},"ğŸ“…")],-1))])]),e("div",ve,[e("div",ge,[e("div",null,[t[11]||(t[11]=e("p",{class:"text-xs md:text-sm text-gray-600"},"Ã€ venir",-1)),e("p",be,n(f.value.upcomingAppointments),1)]),t[12]||(t[12]=e("div",{class:"w-10 h-10 md:w-12 md:h-12 bg-orange-100 rounded-full flex items-center justify-center"},[e("span",{class:"text-xl md:text-2xl"},"ğŸ”œ")],-1))])]),e("div",fe,[e("div",ye,[e("div",null,[t[13]||(t[13]=e("p",{class:"text-xs md:text-sm text-gray-600"},"CrÃ©neaux libres",-1)),e("p",he,n(f.value.availableSlots),1)]),t[14]||(t[14]=e("div",{class:"w-10 h-10 md:w-12 md:h-12 bg-purple-100 rounded-full flex items-center justify-center"},[e("span",{class:"text-xl md:text-2xl"},"âœ…")],-1))])])]),e("div",_e,[e("div",we,[t[20]||(t[20]=e("div",{class:"p-6 border-b border-gray-200"},[e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("span",null,"ğŸ“†"),B(" GÃ©rer les disponibilitÃ©s ")]),e("p",{class:"text-sm text-gray-600 mt-1"}," Ajoutez des crÃ©neaux horaires pour les prochains jours ")],-1)),e("div",ke,[e("form",{onSubmit:z(M,["prevent"]),class:"space-y-4"},[e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Date",-1)),N(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>a.value.date=s),type:"date",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",min:te(g)},null,8,Ae),[[ee,a.value.date]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"CrÃ©neaux horaires",-1)),e("div",Se,[(d(),r(w,null,k($,s=>e("button",{key:s,type:"button",onClick:l=>F(s),class:c(["py-2 px-3 text-sm border rounded-lg transition-colors",a.value.slots.includes(s)?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:border-blue-400"])},n(s),11,Ce)),64))])]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"DurÃ©e (minutes)",-1)),N(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>a.value.duration=s),class:"w-full px-4 py-2 border border-gray-300 rounded-lg"},[...t[17]||(t[17]=[e("option",{value:"30"},"30 minutes",-1),e("option",{value:"60"},"1 heure",-1),e("option",{value:"90"},"1h30",-1),e("option",{value:"120"},"2 heures",-1)])],512),[[se,a.value.duration]])]),e("button",{type:"submit",disabled:h.value||a.value.slots.length===0,class:"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors disabled:opacity-50"},n(h.value?"Ajout...":`Ajouter ${a.value.slots.length} crÃ©neau(x)`),9,je)],32),e("div",De,[e("h3",Be,[t[19]||(t[19]=e("span",null,"DisponibilitÃ©s actuelles",-1)),e("span",Re,n(P.value)+" libres / "+n(O.value)+" total ",1)]),e("div",Te,[(d(!0),r(w,null,k(I.value,s=>(d(),r("div",{key:s.id,class:"border border-gray-200 rounded-lg overflow-hidden"},[e("div",{class:"flex items-center justify-between p-3 bg-gray-50 cursor-pointer hover:bg-gray-100",onClick:l=>G(s.id)},[e("div",ze,[e("span",{class:c(b.value[s.id]?"rotate-90":"")},"â–¶",2),e("div",null,[e("p",Ne,n(T(s.date)),1),e("p",Ve,n(s.slots.filter(l=>!l.isBooked).length)+" libres / "+n(s.slots.filter(l=>l.isBooked).length)+" pris / "+n(s.slots.length)+" total ",1)])]),e("button",{onClick:z(l=>U(s.id),["stop"]),class:"text-red-600 hover:text-red-800 p-2 text-sm"}," ğŸ—‘ï¸ Tout ",8,$e)],8,Ee),b.value[s.id]?(d(),r("div",Ie,[(d(!0),r(w,null,k(s.slots,l=>(d(),r("div",{key:l.id,class:c(["flex items-center justify-between p-2 rounded-lg",l.isBooked?"bg-red-50 border border-red-200":"bg-green-50 border border-green-200"])},[e("div",Fe,[e("span",Me,n(l.time),1),e("span",{class:c(["px-2 py-1 text-xs rounded-full font-medium",l.isBooked?"bg-red-200 text-red-800":"bg-green-200 text-green-800"])},n(l.isBooked?"ğŸ”´ PRIS":"ğŸŸ¢ LIBRE"),3),e("span",Ue,"("+n(l.duration)+"min)",1)]),e("div",Le,[l.isBooked&&D(s.date,l.id)?(d(),r("span",Oe,n(D(s.date,l.id).firstName)+" "+n(D(s.date,l.id).lastName),1)):A("",!0),e("button",{onClick:u=>H(s.id,l.id),class:c(["text-red-600 hover:text-red-800 p-1 text-sm",l.isBooked?"opacity-50 cursor-not-allowed":""]),disabled:l.isBooked,title:l.isBooked?"CrÃ©neau rÃ©servÃ© - annulez le RDV d'abord":"Supprimer ce crÃ©neau"}," ğŸ—‘ï¸ ",10,Pe)])],2))),128))])):A("",!0)]))),128))])])])]),e("div",Ge,[e("div",He,[t[21]||(t[21]=e("h2",{class:"text-xl font-bold flex items-center gap-2"},[e("span",null,"ğŸ“‹"),B(" Rendez-vous ")],-1)),e("div",qe,[e("button",{onClick:t[2]||(t[2]=s=>x.value="all"),class:c(["px-3 py-1 text-sm rounded-full transition-colors",x.value==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700"])}," Tous ",2),e("button",{onClick:t[3]||(t[3]=s=>x.value="upcoming"),class:c(["px-3 py-1 text-sm rounded-full transition-colors",x.value==="upcoming"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700"])}," Ã€ venir ",2),e("button",{onClick:t[4]||(t[4]=s=>x.value="today"),class:c(["px-3 py-1 text-sm rounded-full transition-colors",x.value==="today"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700"])}," Aujourd'hui ",2)])]),e("div",Je,[C.value?(d(),r("div",Ke,[...t[22]||(t[22]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"},null,-1)])])):R.value.length===0?(d(),r("div",Qe,[...t[23]||(t[23]=[e("p",{class:"text-4xl mb-2"},"ğŸ“­",-1),e("p",null,"Aucun rendez-vous",-1)])])):(d(),r("div",We,[(d(!0),r(w,null,k(R.value,s=>(d(),r("div",{key:s.id,class:c(["border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",{"bg-blue-50 border-blue-200":E(s.date)}])},[e("div",Xe,[e("div",Ye,[e("div",Ze,[e("span",et,n(s.time),1),E(s.date)?(d(),r("span",tt," AUJOURD'HUI ")):A("",!0)]),e("p",st,n(s.firstName)+" "+n(s.lastName),1),e("p",ot,"ğŸ“ "+n(s.phone),1),e("p",lt,"âœ‰ï¸ "+n(s.email),1),e("p",nt,"ğŸ“ "+n(s.address||"Adresse non prÃ©cisÃ©e"),1),e("div",it,[e("span",at,n(s.service),1),e("span",rt,n(T(s.date)),1)]),s.notes?(d(),r("p",dt," ğŸ“ "+n(s.notes),1)):A("",!0)]),e("button",{onClick:l=>L(s.id),class:"text-red-600 hover:text-red-800 p-2",title:"Annuler le rendez-vous"}," ğŸ—‘ï¸ ",8,ut)])],2))),128))]))])])])])])}}};export{pt as default};
